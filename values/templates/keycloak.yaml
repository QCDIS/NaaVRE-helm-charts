keycloak:
  enabled: true

  httpRelativePath: '/auth/'
  production: true

  tls:
    enabled: true
    autoGenerated: true

  auth:
    adminUser: "{{ .Values.global.keycloak.adminUser }}"
    adminPassword: "{{ .Values.global.keycloak.adminPassword }}"

  extraEnvVars:
    - name: KEYCLOAK_PROXY_ADDRESS_FORWARDING
      value: "true"
    - name: KC_HOSTNAME_URL
      value: "https://{{ .Values.global.ingressDomain }}/auth/"
    - name: KC_HOSTNAME_ADMIN_URL
      value: "https://{{ .Values.global.ingressDomain }}/auth/"

  ingress:
    annotations:
      kubernetes.io/ingress.class: nginx
      nginx.ingress.kubernetes.io/proxy-buffer-size: "128k"
      nginx.org/server-snippets: |
        location /auth {
          proxy_set_header X-Forwarded-For $host;
          proxy_set_header X-Forwarded-Proto $scheme;
        }
    enabled: true
    path: /auth/
    hostname: "{{ .Values.global.ingressDomain }}"
    tls: true

  postgresql:
    enabled: true
    auth:
      postgresPassword: "{{ .Values.global.keycloak.postgresql.postgresPassword }}"
      password: "{{ .Values.global.keycloak.postgresql.Password }}"
    primary:
      {{- toYaml .Values.global.common.velero | nindent 6 }}
    readReplicas:
      {{- toYaml .Values.global.common.velero | nindent 6 }}

  keycloakConfigCli:
    enabled: true
    configuration:
      realm-configuration.yaml: |
        realm: vre
        enabled: true
        ssoSessionIdleTimeout: 36000
        groups:
          - name: users
            path: /users
        users:
          - username: user
            enabled: true
            credentials:
              - type: password
                value: user
                temporary: false
            groups:
              - users
        clientScopes:
          - id: openid
            name: openid
            protocol: openid-connect
            attributes:
              include.in.token.scope: "true"
              display.on.consent.screen: "true"
        clients:
          - clientId: naavre
            name: NaaVRE
            description: ""
            baseUrl: ""
            rootUrl: "https://{{ .Values.global.ingressDomain }}"
            redirectUris:
              - /*
            enabled: true
            publicClient: true
            clientAuthenticatorType: client-secret
            secret: fake_openid_client_secret
            protocol: openid-connect
            protocolMappers:
              - name: Groups mapper
                protocol: openid-connect
                protocolMapper: oidc-group-membership-mapper
                consentRequired: false
                config:
                  full.path: 'false'
                  id.token.claim: 'true'
                  access.token.claim: 'true'
                  claim.name: groups
                  userinfo.token.claim: 'true'
            defaultClientScopes:
              - web-origins
              - acr
              - openid
              - profile
              - roles
              - email
